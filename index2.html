<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MomCare Risk Assessment & Activity Plan (Full RTCOG Guidelines)</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #fdf2f8; /* Rose-50 */
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useRef, useEffect } = React;

        // --- Icons ---
        const UserIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const DropIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2.69l5.74 5.74c3.2 3.2 3.2 8.38 0 11.58-3.2 3.2-8.38 3.2-11.58 0-3.2-3.2-3.2-8.38 0-11.58L12 2.69z"/></svg>;
        const HeartIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z"/></svg>;
        const ClockIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const CheckIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>;
        const RefreshIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>;
        const CalendarIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>;
        const BloodIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18.6 4.6a2 2 0 0 0-2.8 0l-1.3 1.3a1 1 0 0 1-1.4 0l-1.3-1.3a2 2 0 0 0-2.8 0l-2.5 2.5a2 2 0 0 0 0 2.8l1.3 1.3a1 1 0 0 1 0 1.4l-1.3 1.3a2 2 0 0 0 0 2.8l2.5 2.5a2 2 0 0 0 2.8 0l1.3-1.3a1 1 0 0 1 1.4 0l1.3 1.3a2 2 0 0 0 2.8 0l2.5-2.5a2 2 0 0 0 0-2.8l-1.3-1.3a1 1 0 0 1 0-1.4l1.3-1.3a2 2 0 0 0 0-2.8L18.6 4.6z"/></svg>;
        const FetalIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 12h.01"/><path d="M15 12h.01"/><path d="M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5"/><path d="M20.35 4.65a9 9 0 0 0-16.7 0C2.5 5.55 2 6.72 2 8c0 3.31 2.69 6 6 6h8c3.31 0 6-2.69 6-6 0-1.28-.5-2.45-1.65-3.35z"/></svg>;
        const WarningIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>;

        // --- Components ---
        
        const CheckboxItem = ({ label, checked, onChange, helpText }) => (
            <label className={`
                flex items-start p-3 rounded-lg border cursor-pointer transition-all duration-200 mb-2 group
                ${checked ? 'bg-rose-50 border-rose-400' : 'bg-white border-gray-200 hover:border-rose-300'}
            `}>
                <div className={`
                    mt-0.5 w-5 h-5 rounded border flex items-center justify-center shrink-0 transition-colors
                    ${checked ? 'bg-rose-500 border-rose-500' : 'border-gray-300 bg-white group-hover:border-rose-300'}
                `}>
                    {checked && <svg className="w-3.5 h-3.5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M5 13l4 4L19 7"></path></svg>}
                </div>
                <div className="ml-3 flex-1">
                    <span className={`text-sm font-medium ${checked ? 'text-gray-900' : 'text-gray-600'}`}>{label}</span>
                    {helpText && <p className="text-xs text-gray-400 mt-0.5">{helpText}</p>}
                </div>
                <input type="checkbox" className="hidden" checked={checked} onChange={onChange} />
            </label>
        );

        const InputField = ({ label, value, onChange, placeholder, type = "number", suffix, className }) => (
            <div className={`mb-4 ${className}`}>
                <label className="block text-gray-700 font-bold mb-1 text-sm">{label}</label>
                <div className="relative">
                    <input 
                        type={type}
                        className="w-full px-4 py-2.5 rounded-lg border-gray-200 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-rose-400 focus:border-transparent outline-none transition-all text-sm"
                        placeholder={placeholder}
                        value={value}
                        onChange={onChange}
                    />
                    {suffix && <span className="absolute right-4 top-2.5 text-gray-400 text-sm">{suffix}</span>}
                </div>
            </div>
        );

        const SectionHeader = ({ icon, title, colorClass, bgClass }) => (
            <div className={`flex items-center gap-3 mb-4 p-3 rounded-xl ${bgClass}`}>
                <div className={`${colorClass}`}>{icon}</div>
                <h3 className={`font-bold text-lg ${colorClass.replace('text-', 'text-opacity-90 text-')}`}>{title}</h3>
            </div>
        );

        const ResultCard = ({ title, level, advice, factors, icon }) => {
            const styles = {
                high: { bg: 'bg-red-50', border: 'border-red-200', text: 'text-red-900', badge: 'bg-red-500' },
                moderate: { bg: 'bg-orange-50', border: 'border-orange-200', text: 'text-orange-900', badge: 'bg-orange-400' },
                low: { bg: 'bg-green-50', border: 'border-green-200', text: 'text-green-900', badge: 'bg-green-500' }
            };
            const s = styles[level];
            const levelText = { high: '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á', moderate: '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á', low: '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥' };

            return (
                <div className={`p-5 rounded-2xl border ${s.bg} ${s.border} mb-4 shadow-sm fade-in h-full`}>
                    <div className="flex justify-between items-start mb-3">
                        <div className="flex items-center gap-2">
                            <div className="text-gray-700 opacity-70 scale-90">{icon}</div>
                            <h4 className="font-bold text-lg text-gray-800">{title}</h4>
                        </div>
                        <span className={`px-3 py-1 rounded-full text-xs font-bold text-white shadow-sm ${s.badge}`}>
                            {levelText[level]}
                        </span>
                    </div>

                    {factors.length > 0 && (
                        <div className="mb-3 bg-white/60 p-3 rounded-lg text-sm border border-white/50">
                            <p className="font-bold mb-1 opacity-80 text-xs uppercase tracking-wide">‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏û‡∏ö:</p>
                            <ul className="list-disc list-inside space-y-0.5 opacity-90 text-gray-700">
                                {factors.map((f, i) => <li key={i}>{f}</li>)}
                            </ul>
                        </div>
                    )}
                    <p className="text-sm">
                        <span className="font-bold">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</span> {advice}
                    </p>
                </div>
            );
        };

        const AnemiaFollowUpCard = ({ hct, dateDetected, dateRecheck }) => {
            if (!hct || Number(hct) >= 33) return null;

            const formatDate = (d) => d ? new Date(d).toLocaleDateString('th-TH', { day: 'numeric', month: 'long', year: 'numeric' }) : "-";

            return (
                <div className="mt-6 bg-red-50 rounded-2xl border border-red-200 p-5 fade-in shadow-sm relative overflow-hidden">
                    <div className="absolute right-0 top-0 p-4 opacity-10">
                        <BloodIcon />
                    </div>
                    <div className="flex items-center gap-3 mb-4">
                        <div className="bg-red-100 p-2 rounded-full text-red-600">
                            <WarningIcon />
                        </div>
                        <h3 className="font-bold text-lg text-red-800">‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏ß‡∏∞‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏à‡∏≤‡∏á (Anemia Follow-up)</h3>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                        <div className="bg-white p-3 rounded-xl border border-red-100">
                            <p className="text-gray-500 text-xs mb-1">‡∏ú‡∏• Hct ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</p>
                            <p className="font-bold text-2xl text-red-600">{hct}% <span className="text-sm font-normal text-red-400">(‡∏ã‡∏µ‡∏î)</span></p>
                        </div>
                        <div className="bg-white p-3 rounded-xl border border-red-100">
                            <p className="text-gray-500 text-xs mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö</p>
                            <p className="font-bold text-gray-800">{formatDate(dateDetected)}</p>
                        </div>
                        <div className="bg-white p-3 rounded-xl border border-red-100">
                            <p className="text-gray-500 text-xs mb-1">‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î‡πÄ‡∏à‡∏≤‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏ã‡πâ‡∏≥ (Re-check)</p>
                            <p className="font-bold text-gray-800">{formatDate(dateRecheck)}</p>
                        </div>
                    </div>
                    
                    <div className="mt-4 p-3 bg-red-100/50 rounded-lg text-sm text-red-800 border border-red-200">
                        <span className="font-bold">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏û‡∏¥‡πÄ‡∏®‡∏©:</span> ‡∏Ñ‡∏ß‡∏£‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡πà‡∏á‡∏Ñ‡∏£‡∏±‡∏î ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ô‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏≤‡∏•‡∏î‡∏Å‡∏£‡∏î ‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏°‡∏ô‡∏±‡∏î
                    </div>
                </div>
            );
        };

        const ActivityTable = ({ edc, risks }) => {
            if (!edc) return null;

            const getDates = (edcDate) => {
                const edcTime = new Date(edcDate).getTime();
                const conceptionTime = edcTime - (280 * 24 * 60 * 60 * 1000);
                
                const addWeeks = (w) => {
                    const d = new Date(conceptionTime + (w * 7 * 24 * 60 * 60 * 1000));
                    return d.toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: '2-digit' });
                };
                return addWeeks;
            };

            const getDateStr = getDates(edc);
            let plan = [];

            // 1. First Visit (<12 wks)
            let firstVisitActs = [
                "‡∏ã‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ ‡∏ï‡∏£‡∏ß‡∏à‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢ ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á",
                "‡πÄ‡∏à‡∏≤‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (CBC, VDRL, HIV, HBsAg, Blood Group)",
                "Ultrasound ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå"
            ];
            
            if (risks.preE.level !== 'low') firstVisitActs.push("‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏© (‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô MAP, ‡πÄ‡∏à‡∏≤‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏î PLGF)");
            if (risks.gdm.level === 'high') firstVisitActs.push("üö® ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (50g GCT/OGTT)");
            if (risks.anemia.level === 'high') firstVisitActs.push("üö® ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏ò‡∏≤‡∏•‡∏±‡∏™‡∏ã‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡πÅ‡∏•‡∏∞ CBC ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î");

            plan.push({ ga: "< 12 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå", date: `‡∏Å‡πà‡∏≠‡∏ô ${getDateStr(12)}`, acts: firstVisitActs });

            // 2. 12-16 wks
            let w12Acts = [];
            if (risks.preE.level === 'high') {
                w12Acts.push("üö® ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô Aspirin 150 mg/‡∏ß‡∏±‡∏ô (‡∏´‡∏£‡∏∑‡∏≠ 81mg 2 ‡πÄ‡∏°‡πá‡∏î) ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô");
                w12Acts.push("‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÅ‡∏Ñ‡∏•‡πÄ‡∏ã‡∏µ‡∏¢‡∏° 1-2 g/‡∏ß‡∏±‡∏ô (‡∏´‡∏≤‡∏Å‡∏î‡∏∑‡πà‡∏°‡∏ô‡∏°‡∏ô‡πâ‡∏≠‡∏¢)");
            }
            
            let ironDose = "‡∏¢‡∏≤‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏î (‡∏ò‡∏≤‡∏ï‡∏∏‡πÄ‡∏´‡∏•‡πá‡∏Å 60 mg/‡∏ß‡∏±‡∏ô)";
            if (risks.anemia.level === 'high') {
                 ironDose = "üö® ‡∏¢‡∏≤‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô (‡∏ò‡∏≤‡∏ï‡∏∏‡πÄ‡∏´‡∏•‡πá‡∏Å 100+ mg/‡∏ß‡∏±‡∏ô) ‡∏ï‡∏≤‡∏°‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏™‡∏±‡πà‡∏á";
            }
            w12Acts.push(ironDose);
            
            if (w12Acts.length > 0) {
                 plan.push({ ga: "12 - 16 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå", date: `${getDateStr(12)} - ${getDateStr(16)}`, acts: w12Acts });
            }

            // 3. 16-20 wks
            let w16Acts = ["‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡πÑ‡∏Ç‡πâ‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏´‡∏ç‡πà (Influenza)"];
            if (risks.preterm.level === 'high') w16Acts.push("üö® ‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏õ‡∏≤‡∏Å‡∏°‡∏î‡∏•‡∏π‡∏Å (TVS) / ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ Progesterone");
            plan.push({ ga: "16 - 20 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå", date: `${getDateStr(16)} - ${getDateStr(20)}`, acts: w16Acts });

            // 4. 18-22 wks
            plan.push({ ga: "18 - 22 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå", date: `${getDateStr(18)} - ${getDateStr(22)}`, acts: ["‡∏≠‡∏±‡∏•‡∏ï‡∏£‡∏≤‡∏ã‡∏≤‡∏ß‡∏ô‡∏î‡πå‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏ó‡∏≤‡∏£‡∏Å (Detailed Scan)"] });

            // 5. 24-28 wks
            let w24Acts = ["‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô (Universal Screening) ‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢"];
            plan.push({ ga: "24 - 28 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå", date: `${getDateStr(24)} - ${getDateStr(28)}`, acts: w24Acts });

            // 6. 27-36 wks
            plan.push({ ga: "27 - 36 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå", date: `${getDateStr(27)} - ${getDateStr(36)}`, acts: ["‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏Ñ‡∏≠‡∏ï‡∏µ‡∏ö-‡∏ö‡∏≤‡∏î‡∏ó‡∏∞‡∏¢‡∏±‡∏Å-‡πÑ‡∏≠‡∏Å‡∏£‡∏ô (Tdap)", "‡∏ô‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏î‡∏¥‡πâ‡∏ô (28 wk+)"] });

            // 7. 32-34 wks
            let w32Acts = [];
            if (risks.fetal.level === 'high') {
                w32Acts.push("üö® ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏≤‡∏£‡∏Å (NST/BPP) ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏•‡∏∞ 1-2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
                w32Acts.push("‡∏≠‡∏±‡∏•‡∏ï‡∏£‡∏≤‡∏ã‡∏≤‡∏ß‡∏ô‡∏î‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï (Growth Scan)");
            } else {
                 w32Acts.push("‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏î‡∏¥‡πâ‡∏ô‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠");
            }
            if (w32Acts.length > 0) {
                 plan.push({ ga: "32 - 34 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå", date: `${getDateStr(32)} - ${getDateStr(34)}`, acts: w32Acts });
            }
            
            // 8. 36 wks
            let w36Acts = ["‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ó‡πà‡∏≤‡πÄ‡∏î‡πá‡∏Å / ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Ñ‡∏•‡∏≠‡∏î"];
            if (risks.preE.level === 'high') w36Acts.push("‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ Aspirin ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå 36 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå");
            plan.push({ ga: "36 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ", date: `‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà ${getDateStr(36)}`, acts: w36Acts });

            return (
                <div className="mt-8 bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden fade-in">
                    <div className="bg-rose-500 p-4 text-white flex items-center gap-2">
                        <CalendarIcon />
                        <h3 className="font-bold text-lg">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÄ‡∏ß‡∏ä‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ (RTCOG Guideline)</h3>
                    </div>
                    <div className="overflow-x-auto">
                        <table className="w-full text-left text-sm">
                            <thead className="bg-rose-50 text-rose-800">
                                <tr>
                                    <th className="p-4 font-bold whitespace-nowrap">‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå (GA)</th>
                                    <th className="p-4 font-bold whitespace-nowrap">‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th className="p-4 font-bold w-full">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100">
                                {plan.map((row, idx) => (
                                    <tr key={idx} className="hover:bg-gray-50 transition">
                                        <td className="p-4 font-medium text-gray-900 whitespace-nowrap align-top">{row.ga}</td>
                                        <td className="p-4 text-gray-500 whitespace-nowrap align-top">{row.date}</td>
                                        <td className="p-4 align-top">
                                            <ul className="list-disc list-inside space-y-1 text-gray-700">
                                                {row.acts.map((act, i) => (
                                                    <li key={i} className={act.includes("üö®") ? "text-rose-600 font-bold" : ""}>{act}</li>
                                                ))}
                                            </ul>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    <div className="p-4 bg-gray-50 text-xs text-gray-500 text-center">
                        * ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å EDC ‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡πÇ‡∏õ‡∏£‡∏î‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏à‡∏£‡∏¥‡∏á
                    </div>
                </div>
            );
        };

        const App = () => {
            const [data, setData] = useState({
                age: '', weight: '', height: '', edc: '',
                // Lab
                hct: '', anemiaDetectedDate: '', anemiaRecheckDate: '',
                // General
                isTwins: false, isIVF: false, isSmoking: false, isFirstPregnancy: false, isVegetarian: false,
                // GDM
                historyGDM: false, familyDM: false, isPreExistingDM: false,
                // Pre-E
                historyPreE: false, chronicBP: false, familyPreE: false, isAutoimmune: false,
                // Preterm
                historyPreterm: false,
                // Anemia
                historyAnemia: false,
                // Fetal
                historyStillbirth: false
            });
            const [showResult, setShowResult] = useState(false);
            const resultRef = useRef(null);

            const bmi = useMemo(() => {
                if (data.weight && data.height) {
                    const h = data.height / 100;
                    return (data.weight / (h * h)).toFixed(1);
                }
                return null;
            }, [data.weight, data.height]);

            const isAnemic = useMemo(() => {
                return data.hct && Number(data.hct) < 33;
            }, [data.hct]);

            const updateData = (key, val) => {
                setData(prev => ({ ...prev, [key]: val }));
                if (showResult) setShowResult(false);
            };

            const evaluate = () => {
                const age = Number(data.age) || 0;
                const b = Number(bmi) || 0;

                // --- 1. Diabetes (GDM) Logic ---
                let gdmFactors = [];
                let gdmScore = 0;
                if (data.isPreExistingDM) { 
                    gdmScore += 5; gdmFactors.push("‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå (DM Type 1/2)"); 
                } else {
                    if (age >= 30) { gdmScore += 1; gdmFactors.push("‡∏≠‡∏≤‡∏¢‡∏∏ ‚â• 30 ‡∏õ‡∏µ"); }
                    if (b >= 25) { gdmScore += 1; gdmFactors.push(`BMI ${b} (‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå)`); }
                    if (data.familyDM) { gdmScore += 1; gdmFactors.push("‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô"); }
                    if (data.historyGDM) { gdmScore += 2; gdmFactors.push("‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå"); }
                }
                const gdmLevel = gdmScore >= 2 ? 'high' : gdmScore === 1 ? 'moderate' : 'low';

                // --- 2. Preeclampsia (Pre-E) Logic ---
                let preFactors = [];
                let highRiskCount = 0;
                let moderateRiskCount = 0;

                if (data.historyPreE) { highRiskCount++; preFactors.push("‡πÄ‡∏Ñ‡∏¢‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏©"); }
                if (data.chronicBP) { highRiskCount++; preFactors.push("‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á‡πÄ‡∏£‡∏∑‡πâ‡∏≠‡∏£‡∏±‡∏á/‡πÇ‡∏£‡∏Ñ‡πÑ‡∏ï"); }
                if (data.isAutoimmune) { highRiskCount++; preFactors.push("‡πÇ‡∏£‡∏Ñ‡πÅ‡∏û‡πâ‡∏†‡∏π‡∏°‡∏¥‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á (SLE/APS)"); }
                if (data.isPreExistingDM) { highRiskCount++; preFactors.push("‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå"); }
                if (data.isTwins) { highRiskCount++; preFactors.push("‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÅ‡∏ù‡∏î"); }

                if (data.isFirstPregnancy) { moderateRiskCount++; preFactors.push("‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÅ‡∏£‡∏Å"); }
                if (age >= 35) { moderateRiskCount++; preFactors.push("‡∏≠‡∏≤‡∏¢‡∏∏ ‚â• 35 ‡∏õ‡∏µ"); }
                if (b >= 30) { moderateRiskCount++; preFactors.push(`BMI ${b} (‡∏≠‡πâ‡∏ß‡∏ô)`); }
                if (data.familyPreE) { moderateRiskCount++; preFactors.push("‡πÅ‡∏°‡πà/‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏©"); }
                if (data.isIVF) { moderateRiskCount++; preFactors.push("‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå IVF"); }

                let preLevel = 'low';
                let preAdvice = "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥ ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ö‡∏ß‡∏°/‡∏õ‡∏ß‡∏î‡∏®‡∏µ‡∏£‡∏©‡∏∞";
                if (highRiskCount >= 1) {
                    preLevel = 'high';
                    preAdvice = "‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á! ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏£‡∏¥‡πà‡∏° Aspirin 150mg ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô ‡∏ä‡πà‡∏ß‡∏á 11-14 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå";
                } else if (moderateRiskCount >= 2) {
                    preLevel = 'high';
                    preAdvice = "‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á (‡∏à‡∏≤‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏£‡πà‡∏ß‡∏°)! ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° Aspirin";
                } else if (moderateRiskCount === 1) {
                    preLevel = 'moderate';
                    preAdvice = "‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î";
                }

                // --- 3. Preterm Birth Logic ---
                let termFactors = [];
                let termScore = 0;
                if (data.historyPreterm) { termScore += 2; termFactors.push("‡πÄ‡∏Ñ‡∏¢‡∏Ñ‡∏•‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î"); }
                if (data.isTwins) { termScore += 2; termFactors.push("‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÅ‡∏ù‡∏î"); }
                if (data.isSmoking) { termScore += 1; termFactors.push("‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà"); }
                if (age < 18 || age > 40) { termScore += 1; termFactors.push(age < 18 ? "‡∏≠‡∏≤‡∏¢‡∏∏‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 18" : "‡∏≠‡∏≤‡∏¢‡∏∏‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 40"); }
                const termLevel = termScore >= 2 ? 'high' : termScore === 1 ? 'moderate' : 'low';

                // --- 4. Anemia Risk ---
                let anemiaFactors = [];
                let anemiaScore = 0;
                // Add explicit Lab result factor
                if (isAnemic) { anemiaScore += 5; anemiaFactors.push(`‡∏ú‡∏• Hct ${data.hct}% (‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 33%)`); }
                if (data.historyAnemia) { anemiaScore += 2; anemiaFactors.push("‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ã‡∏µ‡∏î/‡∏ò‡∏≤‡∏•‡∏±‡∏™‡∏ã‡∏µ‡πÄ‡∏°‡∏µ‡∏¢"); }
                if (data.isVegetarian) { anemiaScore += 1; anemiaFactors.push("‡∏ó‡∏≤‡∏ô‡∏°‡∏±‡∏á‡∏™‡∏ß‡∏¥‡∏£‡∏±‡∏ï‡∏¥"); }
                if (data.isTwins) { anemiaScore += 1; anemiaFactors.push("‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÅ‡∏ù‡∏î"); }
                if (age < 20) { anemiaScore += 1; anemiaFactors.push("‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå‡∏ß‡∏±‡∏¢‡∏£‡∏∏‡πà‡∏ô"); }
                
                const anemiaLevel = anemiaScore >= 2 ? 'high' : anemiaScore === 1 ? 'moderate' : 'low';
                const anemiaAdvice = anemiaLevel === 'high' 
                    ? "‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á/‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏†‡∏≤‡∏ß‡∏∞‡∏ã‡∏µ‡∏î ‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏¢‡∏≤‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏±‡∏Å‡∏©‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏• Hct"
                    : "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏Ñ‡∏ß‡∏£‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏î 60 mg/‡∏ß‡∏±‡∏ô";

                // --- 5. Fetal Well-being ---
                let fetalFactors = [];
                let fetalRisk = false;
                if (data.historyStillbirth) { fetalRisk = true; fetalFactors.push("‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏≤‡∏£‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÉ‡∏ô‡∏Ñ‡∏£‡∏£‡∏†‡πå"); }
                if (data.isPreExistingDM || data.chronicBP || data.isAutoimmune) { fetalRisk = true; fetalFactors.push("‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏°‡∏≤‡∏£‡∏î‡∏≤"); }
                if (data.isIVF) { fetalRisk = true; fetalFactors.push("‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå IVF"); }
                if (b >= 30) { fetalRisk = true; fetalFactors.push("BMI ‡∏°‡∏≤‡∏£‡∏î‡∏≤ ‚â• 30"); }
                if (age >= 35) { fetalRisk = true; fetalFactors.push("‡∏≠‡∏≤‡∏¢‡∏∏‡∏°‡∏≤‡∏Å"); }

                const fetalLevel = fetalRisk ? 'high' : 'low';
                const fetalAdvice = fetalLevel === 'high'
                    ? "‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏≤‡∏£‡∏Å (NST) ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà 32-34 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå"
                    : "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏ô‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏î‡∏¥‡πâ‡∏ô‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠‡∏´‡∏•‡∏±‡∏á 28 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå";

                return {
                    gdm: { level: gdmLevel, advice: gdmLevel === 'high' ? "‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à OGTT ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ" : gdmLevel === 'moderate' ? "‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à 24-28 ‡∏ß‡∏µ‡∏Ñ" : "‡∏ù‡∏≤‡∏Å‡∏Ñ‡∏£‡∏£‡∏†‡πå‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥", factors: gdmFactors },
                    preE: { level: preLevel, advice: preAdvice, factors: preFactors },
                    preterm: { level: termLevel, advice: termLevel === 'high' ? "‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Progesterone" : termLevel === 'moderate' ? "‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠" : "‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏Å‡∏≤‡∏£", factors: termFactors },
                    anemia: { level: anemiaLevel, advice: anemiaAdvice, factors: anemiaFactors },
                    fetal: { level: fetalLevel, advice: fetalAdvice, factors: fetalFactors }
                };
            };

            const handleCalculate = () => {
                setShowResult(true);
                setTimeout(() => {
                    resultRef.current?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            };

            const results = showResult ? evaluate() : null;

            return (
                <div className="max-w-4xl mx-auto p-4 pb-20">
                    <div className="text-center mb-6">
                        <h1 className="text-2xl font-bold text-gray-800">MomCare Risk & Plan</h1>
                        <p className="text-gray-500 text-sm">‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏• (‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏£‡∏≤‡∏ä‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏Ø)</p>
                    </div>

                    <div className="space-y-6">
                        {/* 1. General Info & Lab */}
                        <div className="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                            <SectionHeader icon={<UserIcon />} title="‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô & ‡∏ú‡∏•‡πÄ‡∏•‡∏∑‡∏≠‡∏î" bgClass="bg-rose-50" colorClass="text-rose-600" />
                            
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-2">
                                <InputField label="‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)" placeholder="28" value={data.age} onChange={e => updateData('age', e.target.value)} />
                                <InputField label="‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏•‡∏≠‡∏î (Correct EDC)" type="date" value={data.edc} onChange={e => updateData('edc', e.target.value)} />
                            </div>
                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <InputField label="‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏Å.)" placeholder="50" value={data.weight} onChange={e => updateData('weight', e.target.value)} />
                                <InputField label="‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (‡∏ã‡∏°.)" placeholder="160" value={data.height} onChange={e => updateData('height', e.target.value)} />
                            </div>
                            
                            {/* Hct Input */}
                            <div className="bg-gray-50 p-4 rounded-xl border border-gray-200 mb-4">
                                <div className="flex items-center gap-2 mb-3">
                                    <div className="bg-rose-100 p-1.5 rounded-lg"><BloodIcon /></div>
                                    <h4 className="font-bold text-gray-700">‡∏ú‡∏•‡πÄ‡∏•‡∏∑‡∏≠‡∏î (Laboratory)</h4>
                                </div>
                                <InputField 
                                    label="‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î (Hematocrit %)" 
                                    placeholder="‡πÄ‡∏ä‡πà‡∏ô 35" 
                                    value={data.hct} 
                                    onChange={e => updateData('hct', e.target.value)}
                                    suffix="%"
                                    className="mb-0"
                                />
                                
                                {isAnemic && (
                                    <div className="mt-4 p-4 bg-white border border-red-200 rounded-lg fade-in">
                                        <p className="text-red-600 font-bold text-sm mb-3 flex items-center gap-2">
                                            <WarningIcon /> ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏†‡∏≤‡∏ß‡∏∞‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏à‡∏≤‡∏á (Hct &lt; 33%)
                                        </p>
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                            <InputField 
                                                label="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö (Date Detected)" 
                                                type="date" 
                                                value={data.anemiaDetectedDate} 
                                                onChange={e => updateData('anemiaDetectedDate', e.target.value)}
                                            />
                                            <InputField 
                                                label="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î‡πÄ‡∏à‡∏≤‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏ã‡πâ‡∏≥ (Date Re-check)" 
                                                type="date" 
                                                value={data.anemiaRecheckDate} 
                                                onChange={e => updateData('anemiaRecheckDate', e.target.value)}
                                            />
                                        </div>
                                    </div>
                                )}
                            </div>

                            {bmi && (
                                <div className="text-center p-2 bg-gray-50 rounded-lg text-gray-600 text-sm mb-4">
                                    ‡∏Ñ‡πà‡∏≤ BMI ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <span className="font-bold text-gray-800">{bmi}</span>
                                </div>
                            )}

                            <div className="mt-3 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2">
                                <CheckboxItem label="‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÅ‡∏£‡∏Å (First Pregnancy)" checked={data.isFirstPregnancy} onChange={() => updateData('isFirstPregnancy', !data.isFirstPregnancy)} />
                                <CheckboxItem label="‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÅ‡∏ù‡∏î" checked={data.isTwins} onChange={() => updateData('isTwins', !data.isTwins)} />
                                <CheckboxItem label="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå‡∏î‡πâ‡∏ß‡∏¢ IVF" checked={data.isIVF} onChange={() => updateData('isIVF', !data.isIVF)} />
                                <CheckboxItem label="‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà" checked={data.isSmoking} onChange={() => updateData('isSmoking', !data.isSmoking)} />
                                <CheckboxItem label="‡∏ó‡∏≤‡∏ô‡∏°‡∏±‡∏á‡∏™‡∏ß‡∏¥‡∏£‡∏±‡∏ï‡∏¥ (Vegetarian)" checked={data.isVegetarian} onChange={() => updateData('isVegetarian', !data.isVegetarian)} />
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            {/* 2. Diabetes Risk */}
                            <div className="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 h-full">
                                <SectionHeader icon={<DropIcon />} title="‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô" bgClass="bg-teal-50" colorClass="text-teal-600" />
                                <div className="space-y-2">
                                    <CheckboxItem label="‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå (DM)" checked={data.isPreExistingDM} onChange={() => updateData('isPreExistingDM', !data.isPreExistingDM)} helpText="‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏©‡∏î‡πâ‡∏ß‡∏¢" />
                                    <CheckboxItem label="‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå (GDM)" checked={data.historyGDM} onChange={() => updateData('historyGDM', !data.historyGDM)} />
                                    <CheckboxItem label="‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô" checked={data.familyDM} onChange={() => updateData('familyDM', !data.familyDM)} />
                                </div>
                            </div>

                            {/* 3. Pre-E Risk */}
                            <div className="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 h-full">
                                <SectionHeader icon={<HeartIcon />} title="‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏©" bgClass="bg-orange-50" colorClass="text-orange-600" />
                                <div className="space-y-2 mb-3">
                                    <CheckboxItem label="‡πÄ‡∏Ñ‡∏¢‡∏°‡∏µ‡∏†‡∏≤‡∏ß‡∏∞ '‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏©'" checked={data.historyPreE} onChange={() => updateData('historyPreE', !data.historyPreE)} />
                                    <CheckboxItem label="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á‡πÄ‡∏£‡∏∑‡πâ‡∏≠‡∏£‡∏±‡∏á / ‡πÇ‡∏£‡∏Ñ‡πÑ‡∏ï" checked={data.chronicBP} onChange={() => updateData('chronicBP', !data.chronicBP)} />
                                    <CheckboxItem label="‡πÇ‡∏£‡∏Ñ‡πÅ‡∏û‡πâ‡∏†‡∏π‡∏°‡∏¥‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á (SLE / APS)" checked={data.isAutoimmune} onChange={() => updateData('isAutoimmune', !data.isAutoimmune)} />
                                </div>
                                <CheckboxItem label="‡πÅ‡∏°‡πà/‡∏û‡∏µ‡πà‡∏™‡∏≤‡∏ß/‡∏ô‡πâ‡∏≠‡∏á‡∏™‡∏≤‡∏ß ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏©" checked={data.familyPreE} onChange={() => updateData('familyPreE', !data.familyPreE)} />
                            </div>

                            {/* 4. Preterm Risk */}
                            <div className="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 h-full">
                                <SectionHeader icon={<ClockIcon />} title="‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏•‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î" bgClass="bg-indigo-50" colorClass="text-indigo-600" />
                                <CheckboxItem label="‡πÄ‡∏Ñ‡∏¢‡∏Ñ‡∏•‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î" checked={data.historyPreterm} onChange={() => updateData('historyPreterm', !data.historyPreterm)} helpText="‡∏Ñ‡∏•‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô 37 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå" />
                            </div>

                             {/* 5. Additional Risks */}
                             <div className="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 h-full">
                                <SectionHeader icon={<BloodIcon />} title="‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ" bgClass="bg-pink-50" colorClass="text-pink-600" />
                                <div className="space-y-2">
                                    <CheckboxItem label="‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏à‡∏≤‡∏á/‡∏ò‡∏≤‡∏•‡∏±‡∏™‡∏ã‡∏µ‡πÄ‡∏°‡∏µ‡∏¢" checked={data.historyAnemia} onChange={() => updateData('historyAnemia', !data.historyAnemia)} />
                                    <CheckboxItem label="‡πÄ‡∏Ñ‡∏¢‡∏ó‡∏≤‡∏£‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÉ‡∏ô‡∏Ñ‡∏£‡∏£‡∏†‡πå" checked={data.historyStillbirth} onChange={() => updateData('historyStillbirth', !data.historyStillbirth)} helpText="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏≤‡∏£‡∏Å‡πÉ‡∏ô‡∏Ñ‡∏£‡∏£‡∏†‡πå‡∏ô‡∏µ‡πâ" />
                                </div>
                            </div>
                        </div>

                        {/* Action Button */}
                        <button 
                            onClick={handleCalculate}
                            disabled={!data.age || !data.weight}
                            className={`w-full py-4 rounded-xl font-bold text-lg shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2
                                ${!data.age || !data.weight 
                                    ? 'bg-gray-300 text-gray-500 cursor-not-allowed' 
                                    : 'bg-rose-600 hover:bg-rose-700 text-white shadow-rose-200'}
                            `}
                        >
                            <CheckIcon /> ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•
                        </button>

                        {/* Results Section */}
                        {showResult && results && (
                            <div ref={resultRef} className="pt-6 border-t-2 border-dashed border-gray-200 fade-in">
                                <div className="text-center mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h2>
                                    <p className="text-sm text-gray-500">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÄ‡∏ß‡∏ä‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ RTCOG</p>
                                </div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <ResultCard title="‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô (GDM)" level={results.gdm.level} advice={results.gdm.advice} factors={results.gdm.factors} icon={<DropIcon />} />
                                    <ResultCard title="‡∏Ñ‡∏£‡∏£‡∏†‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏©" level={results.preE.level} advice={results.preE.advice} factors={results.preE.factors} icon={<HeartIcon />} />
                                    <ResultCard title="‡∏Ñ‡∏•‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î" level={results.preterm.level} advice={results.preterm.advice} factors={results.preterm.factors} icon={<ClockIcon />} />
                                    <ResultCard title="‡∏†‡∏≤‡∏ß‡∏∞‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏à‡∏≤‡∏á" level={results.anemia.level} advice={results.anemia.advice} factors={results.anemia.factors} icon={<BloodIcon />} />
                                    <ResultCard title="‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏≤‡∏£‡∏Å" level={results.fetal.level} advice={results.fetal.advice} factors={results.fetal.factors} icon={<FetalIcon />} />
                                </div>

                                {/* Separated Anemia Follow Up Card */}
                                <AnemiaFollowUpCard 
                                    hct={data.hct} 
                                    dateDetected={data.anemiaDetectedDate}
                                    dateRecheck={data.anemiaRecheckDate}
                                />

                                {/* Activity Table */}
                                <ActivityTable edc={data.edc} risks={results} />
                                
                                <button 
                                    onClick={() => {
                                        window.scrollTo({ top: 0, behavior: 'smooth' });
                                        setData({
                                            age: '', weight: '', height: '', edc: '',
                                            hct: '', anemiaDetectedDate: '', anemiaRecheckDate: '',
                                            isTwins: false, isIVF: false, isSmoking: false, isFirstPregnancy: false, isVegetarian: false,
                                            historyGDM: false, familyDM: false, isPreExistingDM: false,
                                            historyPreE: false, chronicBP: false, familyPreE: false, isAutoimmune: false,
                                            historyPreterm: false, historyAnemia: false, historyStillbirth: false
                                        });
                                        setShowResult(false);
                                    }}
                                    className="w-full mt-8 py-3 bg-gray-100 text-gray-600 font-bold rounded-xl hover:bg-gray-200 flex items-center justify-center gap-2"
                                >
                                    <RefreshIcon /> ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>